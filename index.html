<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cover Letter Builder</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f7fa;
  }
  header {
    background: #2a4d69;
    color: white;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.4em;
    font-weight: 600;
    border-radius: 8px;
    margin-bottom: 15px;
  }
  .container {
    display: flex;
    gap: 20px;
    min-height: 650px;
  }
  .form-container {
    flex: 38%;
    background: white;
    padding: 20px 25px;
    border-radius: 8px;
    box-shadow: 0 3px 9px rgba(0,0,0,0.1);
    overflow-y: auto;
  }
  .preview-container {
    flex: 62%;
    background: white;
    padding: 30px 40px;
    border-radius: 8px;
    box-shadow: 0 3px 9px rgba(0,0,0,0.1);
    overflow-y: auto;
    min-height: 650px;
    line-height: 1.4;
    white-space: pre-wrap;
  }
  label {
    font-weight: bold;
    margin-top: 15px;
    display: block;
  }
  input, textarea, select, button {
    width: 100%;
    padding: 9px 10px;
    margin-top: 5px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    box-sizing: border-box;
    transition: border-color 0.2s ease;
  }
  input:focus, textarea:focus, select:focus {
    border-color: #2a4d69;
    outline: none;
  }
  textarea {
    resize: vertical;
  }
  .quick-templates button {
    background: #2a4d69;
    color: white;
    border: none;
    padding: 8px 16px;
    margin: 4px 8px 12px 0;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
  }
  .quick-templates button:hover {
    background: #1d344b;
  }
  #downloadBtn, #resetBtn {
    background: #2a4d69;
    color: white;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
  }
  #downloadBtn:hover, #resetBtn:hover {
    background: #1d344b;
  }
  .flex-row {
    display: flex;
    gap: 10px;
  }
  .flex-row > * {
    flex: 1;
  }
  p.preview-header {
    font-weight: 600;
    font-size: 1.25em;
    margin: 0 0 4px 0; /* tightened vertical spacing */
    line-height: 1.1;
  }
  p.contact-info {
    margin: 0 0 4px 0; /* tightened vertical spacing */
    font-weight: 500;
    font-size: 0.95em;
    line-height: 1.1;
  }
  p.address-info {
    margin: 0 0 4px 0; /* tightened vertical spacing */
    font-style: normal;
    line-height: 1.1;
  }
  p.recipient-info {
    margin: 0 0 6px 0; /* tightened vertical spacing */
    font-weight: 600;
    line-height: 1.1;
  }
  hr {
    margin: 20px 0;
    border: none;
    border-top: 1px solid #ddd;
  }
  /* Background Styles */
  .bg-classic {
    background: white;
    color: black;
  }
  .bg-blueaccents {
    background: white;
    color: #2a4d69;
  }
  .bg-darkmode {
    background: #121212;
    color: #eee;
  }
  .bg-softbeige {
    background: #fef6e4;
    color: #5a4d41;
  }
</style>
</head>
<body>

<header>Cover Letter Builder</header>

<div class="container">
  <div class="form-container">
    <div class="quick-templates" aria-label="Quick Templates">
      <button type="button" data-template="nurse">Nurse</button>
      <button type="button" data-template="entry">Entry Level</button>
      <button type="button" data-template="leadership">Leadership</button>
      <button type="button" data-template="travel">Travel Nurse</button>
      <button type="button" data-template="cna">CNA</button>
      <button type="button" data-template="generic">Generic Professional</button>
    </div>

    <label for="headerInput">Header (e.g., Your Name & Title)</label>
    <input type="text" id="headerInput" placeholder="Jane Doe, RN" />

    <label for="dateInput">Date</label>
    <input type="date" id="dateInput" />

    <label for="senderInput">Your Name</label>
    <input type="text" id="senderInput" placeholder="Your full name" />

    <div class="flex-row">
      <div>
        <label for="phoneInput">Phone Number</label>
        <input type="tel" id="phoneInput" placeholder="(123) 456-7890" />
      </div>
      <div>
        <label for="emailInput">Email</label>
        <input type="email" id="emailInput" placeholder="you@example.com" />
      </div>
    </div>

    <label for="addressInput">Your Address</label>
    <textarea id="addressInput" rows="3" placeholder="Street, City, State, ZIP"></textarea>

    <label for="recipientInput">Recipient Name</label>
    <input type="text" id="recipientInput" placeholder="Hiring Manager / Recipient" />

    <label for="companyInput">Company</label>
    <input type="text" id="companyInput" placeholder="Company or Organization" />

    <label for="bodyInput">Cover Letter Body</label>
    <textarea id="bodyInput" rows="12" placeholder="Write your cover letter here..."></textarea>

    <label for="closingInput">Closing</label>
    <input type="text" id="closingInput" value="Sincerely," />

    <label for="fontsizeSelect">Font Size</label>
    <select id="fontsizeSelect" aria-label="Select font size">
      <option value="14">14px</option>
      <option value="16" selected>16px</option>
      <option value="18">18px</option>
    </select>

    <label for="fontstyleSelect">Font Style</label>
    <select id="fontstyleSelect" aria-label="Select font style">
      <option value="Arial">Arial</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Georgia">Georgia</option>
      <option value="Verdana">Verdana</option>
    </select>

    <label for="backgroundStyleSelect">Background Style</label>
    <select id="backgroundStyleSelect" aria-label="Select background style">
      <option value="bg-classic" selected>Classic (White / Black)</option>
      <option value="bg-blueaccents">Blue Accents</option>
      <option value="bg-softbeige">Soft Beige</option>
      <option value="bg-darkmode">Dark Mode</option>
    </select>

    <button id="downloadBtn" type="button">Download PDF</button>
    <button id="resetBtn" type="button">Reset Form</button>
  </div>

  <div class="preview-container bg-classic" id="preview" aria-live="polite" aria-label="Cover letter live preview">
    <div id="previewContent" style="width: 100%; height: 100%;"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const templates = {
      nurse: `I am excited to apply for the Registered Nurse position at your hospital. I bring strong clinical skills and compassionate care, committed to delivering excellent patient outcomes.`,
      entry: `As a recent graduate, I am eager to begin my nursing career and contribute to your healthcare team with enthusiasm and dedication.`,
      leadership: `With extensive experience leading nursing teams, I am confident in my ability to support your facility in achieving outstanding patient care and operational excellence.`,
      travel: `As a dedicated Travel Nurse, I offer flexibility, adaptability, and a passion for serving diverse communities while maintaining the highest standards of care.`,
      cna: `I am applying for the Certified Nursing Assistant position with a strong focus on compassionate patient support and effective collaboration with medical staff.`,
      generic: `I am writing to express my interest in the available position at your organization. I bring a strong work ethic, excellent communication skills, and a commitment to contributing effectively to your team.`
    };

    const headerInput = document.getElementById('headerInput');
    const dateInput = document.getElementById('dateInput');
    const senderInput = document.getElementById('senderInput');
    const phoneInput = document.getElementById('phoneInput');
    const emailInput = document.getElementById('emailInput');
    const addressInput = document.getElementById('addressInput');
    const recipientInput = document.getElementById('recipientInput');
    const companyInput = document.getElementById('companyInput');
    const bodyInput = document.getElementById('bodyInput');
    const closingInput = document.getElementById('closingInput');
    const fontsizeSelect = document.getElementById('fontsizeSelect');
    const fontstyleSelect = document.getElementById('fontstyleSelect');
    const backgroundStyleSelect = document.getElementById('backgroundStyleSelect');
    const previewContent = document.getElementById('previewContent');
    const preview = document.getElementById('preview');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');

    const quickButtons = document.querySelectorAll('.quick-templates button');

    function escapeHtml(text) {
      if (!text) return "";
      return text.replace(/[&<>"']/g, function(m) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        })[m];
      });
    }

    function updatePreview() {
      const header = escapeHtml(headerInput.value);
      const date = dateInput.value ? new Date(dateInput.value).toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' }) : "";
      const sender = escapeHtml(senderInput.value);
      const phone = escapeHtml(phoneInput.value);
      const email = escapeHtml(emailInput.value);
      const address = escapeHtml(addressInput.value).replace(/\n/g, '<br>');
      const recipient = escapeHtml(recipientInput.value);
      const company = escapeHtml(companyInput.value);
      const closing = escapeHtml(closingInput.value);
      const letterBody = escapeHtml(bodyInput.value).replace(/\n/g, '<br><br>');
      const fontSize = fontsizeSelect.value + "px";
      const fontFamily = fontstyleSelect.value;

      const contactLine = (phone || email) ? `<p class="contact-info"><strong>Phone:</strong> ${phone || 'N/A'} | <strong>Email:</strong> ${email || 'N/A'}</p>` : "";

      let html = `
        <div style="font-size: ${fontSize}; font-family: ${fontFamily};">
          <div style="margin-bottom: 10px;">
            ${header ? `<p class="preview-header">${header}</p>` : ''}
            ${date ? `<p class="preview-header">${date}</p>` : ''}
            <p class="preview-header" style="margin-bottom:2px;">${sender}</p>
            ${contactLine}
            <p class="address-info">${address}</p>
            <p class="recipient-info">${recipient}<br>${company}</p>
          </div>
          <hr>
          <p>${letterBody}</p>
          <p style="margin-top: 24px;">${closing}<br>${sender}</p>
        </div>
      `;

      preview.className = `preview-container ${backgroundStyleSelect.value || 'bg-classic'}`;
      previewContent.innerHTML = html;

      if (!date && !sender && !recipient && !company && !bodyInput.value.trim()) {
        previewContent.innerHTML = `<p style="text-align:center; color:#95a5a6; font-style: italic; user-select:none;">
          Live preview will appear here once you start typing or select a template...
        </p>`;
      }
    }

    quickButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.getAttribute('data-template');
        if (type && templates[type]) {
          bodyInput.value = templates[type];
          updatePreview();
        }
      });
    });

    [
      headerInput, dateInput, senderInput, phoneInput, emailInput, addressInput,
      recipientInput, companyInput, bodyInput, closingInput, fontsizeSelect,
      fontstyleSelect, backgroundStyleSelect
    ].forEach(el => el.addEventListener('input', updatePreview));

    downloadBtn.addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const lineHeight = 7; // vertical spacing for PDF text lines
      let y = 20;  // starting vertical position

      const fontSize = parseInt(fontsizeSelect.value) || 16;
      const fontFamily = fontstyleSelect.value || 'Arial';
      doc.setFont(fontFamily);
      doc.setFontSize(fontSize);

      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 20;
      const maxWidth = pageWidth - margin * 2;

      function printWrapped(text, x, y) {
        const lines = doc.splitTextToSize(text, maxWidth);
        doc.text(lines, x, y);
        return y + lines.length * lineHeight;
      }

      const header = headerInput.value.trim();
      const dateStr = dateInput.value ? new Date(dateInput.value).toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' }) : "";
      const sender = senderInput.value.trim();
      const phone = phoneInput.value.trim();
      const email = emailInput.value.trim();
      const address = addressInput.value.trim();
      const recipient = recipientInput.value.trim();
      const company = companyInput.value.trim();
      const bodyText = bodyInput.value.trim();
      const closing = closingInput.value.trim() || "Sincerely,";

      if (header) {
        y = printWrapped(header, margin, y);
      }
      if (dateStr) {
        y = printWrapped(dateStr, margin, y + 2);
      }
      if (sender) {
        y = printWrapped(sender, margin, y + 4);
      }
      if (phone || email) {
        let contactLine = "";
        if (phone) contactLine += `Phone: ${phone}`;
        if (phone && email) contactLine += " | ";
        if (email) contactLine += `Email: ${email}`;
        y = printWrapped(contactLine, margin, y + 2);
      }
      if (address) {
        y = printWrapped(address, margin, y + 4);
      }
      if (recipient) {
        y = printWrapped(`To: ${recipient}`, margin, y + 6);
      }
      if (company) {
        y = printWrapped(company, margin, y);
      }

      y += 6;
      doc.setLineWidth(0.5);
      doc.line(margin, y, pageWidth - margin, y);
      y += 10;

      if (bodyText) {
        y = printWrapped(bodyText.replace(/\n/g, "\n\n"), margin, y);
      }

      y += 12;
      if (closing) {
        y = printWrapped(closing, margin, y);
      }
      if (sender) {
        y = printWrapped(sender, margin, y + 8);
      }

      doc.save("cover_letter.pdf");
    });

    resetBtn.addEventListener('click', () => {
      headerInput.value = "";
      dateInput.value = "";
      senderInput.value = "";
      phoneInput.value = "";
      emailInput.value = "";
      addressInput.value = "";
      recipientInput.value = "";
      companyInput.value = "";
      bodyInput.value = "";
      closingInput.value = "Sincerely,";
      fontsizeSelect.value = "16";
      fontstyleSelect.value = "Arial";
      backgroundStyleSelect.value = "bg-classic";
      updatePreview();
    });

    updatePreview();
  });
</script>

</body>
</html>
